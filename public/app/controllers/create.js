// Generated by CoffeeScript 1.8.0
(function() {
  define(function(require, exports, module) {
    var App, ConfirmationView, Marionette, ReviewView, msgBus, view;
    Marionette = require('marionette');
    App = require('app');
    msgBus = require('msgbus');
    ReviewView = require('views/create/review');
    ConfirmationView = require('views/create/confirmation');
    view = null;
    App.flow = 'create';
    module.exports = Marionette.Controller.extend({
      index: function(date) {
        console.log('Create: date attr', date);
        date = App.utils.isValidDate(date) ? date : App.utils.TOMORROW;
        msgBus.reqres.request('schedule:header', {
          pageTitle: 'Schedule Training'
        });
        msgBus.reqres.request('schedule:trainer:filter');
        msgBus.reqres.request('schedule:calendar:navigation', {
          startDate: date
        });
        App.filterCriteria.set({
          startDate: date
        });
        return App.analytics.set({
          action: 'add-start'
        });
      },
      review: function(appointment) {
        msgBus.reqres.request('schedule:header', {
          pageTitle: 'Review your session'
        });
        view = new ReviewView({
          model: appointment
        });
        App.layout.filter.close();
        App.layout.navigation.close();
        App.layout.content.show(view);
        return App.analytics.set({
          action: 'add-review'
        });
      },
      confirmation: function(appointment) {
        var data;
        data = _.pick(appointment.toJSON(), 'id', 'sessionTypeId', 'trainerId', 'startDate', 'endDate', 'message');
        return require(['entities/create'], function() {
          var promise;
          promise = msgBus.reqres.request('entities:create:appointment', data);
          promise.done(function(response) {
            appointment.set({
              id: response.id,
              APIEndpoint: App.APIEndpoint
            });
            msgBus.reqres.request('schedule:header', {
              pageTitle: 'Enjoy your workout.'
            });
            view = new ConfirmationView({
              model: appointment
            });
            App.layout.navigation.close();
            App.layout.content.show(view);
            return App.analytics.set({
              action: 'add-complete'
            });
          });
          return promise.fail(function(response) {
            return msgBus.reqres.request('schedule:error', response.responseJSON);
          });
        });
      }
    });
  });

}).call(this);

//# sourceMappingURL=create.js.map
