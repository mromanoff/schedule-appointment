// Generated by CoffeeScript 1.8.0
(function() {
  define(function(require, exports, module) {
    var App, CancelView, ConfirmationView, Marionette, ReviewView, msgBus, view;
    Marionette = require('marionette');
    App = require('app');
    msgBus = require('msgbus');
    CancelView = require('views/cancel/index');
    ReviewView = require('views/cancel/review');
    ConfirmationView = require('views/cancel/confirmation');
    view = null;
    App.flow = 'cancel';
    return module.exports = Marionette.Controller.extend({
      index: function(id) {
        msgBus.reqres.request('schedule:header', {
          pageTitle: 'Cancel your session'
        });
        return require(['entities/appointment'], function() {
          var promise;
          promise = msgBus.reqres.request('entities:appointment', id);
          promise.done(function(appointment) {
            view = new CancelView({
              model: appointment
            });
            App.layout.content.show(view);
            return App.analytics.set({
              action: 'delete-start'
            });
          });
          return promise.fail(function(model, jqXHR, textStatus) {
            return msgBus.reqres.request('schedule:error', {
              error: [model, jqXHR, textStatus]
            });
          });
        });
      },
      review: function(appointment) {
        msgBus.reqres.request('schedule:header', {
          pageTitle: 'Cancel your session'
        });
        view = new ReviewView({
          model: appointment
        });
        App.layout.content.show(view);
        return App.analytics.set({
          action: 'delete-review'
        });
      },
      confirmation: function(appointment) {
        var data;
        data = _.pick(appointment.toJSON(), 'id', 'cancelAll', 'message');
        return require(['entities/cancel'], function() {
          var promise;
          promise = msgBus.reqres.request('entities:cancel:appointment', data);
          promise.done(function(response) {
            appointment.set({
              id: response.id,
              APIEndpoint: App.APIEndpoint
            });
            msgBus.reqres.request('schedule:header', {
              pageTitle: 'Your session is canceled'
            });
            view = new ConfirmationView({
              model: appointment
            });
            App.layout.content.show(view);
            return App.analytics.set({
              action: 'delete-complete'
            });
          });
          return promise.fail(function(response) {
            return msgBus.reqres.request('schedule:error', response.responseJSON);
          });
        });
      }
    });
  });

}).call(this);

//# sourceMappingURL=cancel.js.map
